@using MediReserva.Models
@using MudBlazor
@inject IEspecialidadService EspecialidadService
@inject IMedicoService MedicoService
@inject ISnackbar Snackbar

@namespace MediReserva.Pages.Modals

<MudDialog>
    <DialogContent>
        <MudStack Spacing="3">
            <MudTextField Label="Nombre" @bind-Value="_medico.Nombre" Required="true" />
            <MudTextField Label="Email" @bind-Value="_medico.Email" />
            <MudTextField Label="Teléfono" @bind-Value="_medico.Telefono" />
            <MudTextField Label="Consultorio" @bind-Value="_medico.Consultorio" />
            <MudSelect T="int" Label="Especialidad" @bind-Value="_medico.EspecialidadId" Required="true" Clearable="true">
                <MudSelectItem Value="-1">-- Seleccione una especialidad --</MudSelectItem>
                @foreach (var especialidad in Especialidades)
                {
                    <MudSelectItem Value="@especialidad.Id">@especialidad.Nombre</MudSelectItem>
                }
            </MudSelect>
        </MudStack>
    </DialogContent>

    <DialogActions>
        <MudButton Color="Color.Primary" OnClick="Guardar">Guardar</MudButton>
        <MudButton Color="Color.Secondary" OnClick="Cancelar">Cancelar</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    IDialogReference MudDialog { get; set; } = default!;

    [Parameter]
    public Medico MedicoParametro { get; set; } = new();

    private Medico _medico = new();
    private List<Especialidad> Especialidades = new();

    protected override async Task OnInitializedAsync()
    {
        // Si viene por parámetro un médico, clonar sus datos
        _medico = new Medico
            {
                Id = MedicoParametro.Id,
                Nombre = MedicoParametro.Nombre,
                Email = MedicoParametro.Email,
                Telefono = MedicoParametro.Telefono,
                Consultorio = MedicoParametro.Consultorio,
                EspecialidadId = MedicoParametro.EspecialidadId
            };

        Especialidades = await EspecialidadService.GetAllAsync();
    }

    private async Task Guardar()
    {
        if (string.IsNullOrWhiteSpace(_medico.Nombre) || _medico.EspecialidadId <= 0)
            return;

        await MedicoService.AddAsync(_medico);

        Snackbar.Add("Médico creado con éxito", Severity.Success);

        MudDialog?.Close(DialogResult.Ok(_medico));
    }



    private void Cancelar()
    {
        _medico = new Medico(); // Limpia los campos (opcional si deseas persistencia)
        MudDialog?.Close(DialogResult.Cancel());
    }



}
